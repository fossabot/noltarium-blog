<script>
  $(document).ready(function() {

    var client = new Keen({
      projectId: "{{ site.keen_projectId }}",
      readKey: "{{ site.keen_api_readKey }}"
    });

    Keen.ready(function() {
      var el = document.getElementById("git-jekyll-site-master-push-count");
      var chart = new Keen.Dataviz()
        .el(el)
        .chartType('metric')
        .title('on Master Last (14d)')
        .prepare();

      client
        .query("count", {
          event_collection: "commit",
          filters: [{
              "operator": "eq",
              "property_name": "repository.id",
              "property_value": {{site.keen_github_project_id}}
            },
            {
              "operator": "eq",
              "property_name": "ref",
              "property_value": "refs/heads/master"
            }
          ],
          timeframe: "this_14_days",
          timezone: "Europe/Paris"
        })
        .then(function(res) {
          chart.data(res).render();
        })
        .catch(function(err) {
          chart.message(err.message);
        });

    });

    Keen.ready(function() {
      var el = document.getElementById("git-jekyll-site-not-master-push-count");
      var chart = new Keen.Dataviz()
        .el(el)
        .chartType('metric')
        .title('other commits Last (14d)')
        .prepare();

      client
        .query("count", {
          event_collection: "commit",
          filters: [{
              "operator": "eq",
              "property_name": "repository.id",
              "property_value": {{site.keen_github_project_id}}
            },
            {
              "operator": "ne",
              "property_name": "ref",
              "property_value": "refs/heads/master"
            }
          ],
          timeframe: "this_14_days",
          timezone: "Europe/Paris"
        })
        .then(function(res) {
          chart.data(res).render();
        })
        .catch(function(err) {
          chart.message(err.message);
        });

    });
    Keen.ready(function() {
      var el = document.getElementById("git-push-count");
      var chart = new Keen.Dataviz()
        .el(el)
        .chartType('metric')
        .title('all pushs Last (14d)')
        .prepare();

      client
        .query("count", {
          event_collection: "commit",
          timeframe: "this_14_days",
          timezone: "Europe/Paris"
        })
        .then(function(res) {
          chart.data(res).render();
        })
        .catch(function(err) {
          chart.message(err.message);
        });

    });

    Keen.ready(function() {
      var el = document.getElementById("git-jekyll-site-branch-push-count");
      var chart = new Keen.Dataviz()
        .el(el)
        .chartType('metric')
        .title('Active Branches Last (14d)')
        .prepare();

      client
        .query("count_unique", {
          event_collection: "commit",
          filters: [{
            "operator": "eq",
            "property_name": "repository.id",
            "property_value": {{site.keen_github_project_id}}
          }],
          target_property: "ref",
          timeframe: "this_14_years",
          timezone: "UTC"
        })
        .then(function(res) {
          chart.data(res).render();
        })
        .catch(function(err) {
          chart.message(err.message);
        });

    });

    Keen.ready(function() {
      var el = document.getElementById("docker-push-count");
      var chart = new Keen.Dataviz()
        .el(el)
        .chartType('metric')
        .title('Docker Hub Activities Last (14d)')
        .prepare();

      client
        .query("count", {
          event_collection: "dockerhub",
          timeframe: "this_14_years",
          timezone: "UTC"
        })
        .then(function(res) {
          chart.data(res).render();
        })
        .catch(function(err) {
          chart.message(err.message);
        });

    });

    Keen.ready(function() {
      var el = document.getElementById("docker-push-count-unique");
      var chart = new Keen.Dataviz()
        .el(el)
        .chartType('metric')
        .title('Active Projects Last (14d)')
        .prepare();

      client
        .query("count_unique", {
          event_collection: "dockerhub",
          target_property: "repository.repo_name",
          timeframe: "this_14_years",
          timezone: "UTC"
        })
        .then(function(res) {
          chart.data(res).render();
        })
        .catch(function(err) {
          chart.message(err.message);
        });

    });
    Keen.ready(function() {
      var el = document.getElementById("docker-push-count-presentation");
      var chart = new Keen.Dataviz()
        .el(el)
        .chartType('metric')
        .title('Presentation pushs Last (14d)')
        .prepare();

      client
        .query("count", {
          event_collection: "dockerhub",
          filters: [{
            "operator": "eq",
            "property_name": "repository.repo_name",
            "property_value": "nolte/bog.noltarium.de"
          }],
          timeframe: "this_14_years",
          timezone: "UTC"
        })
        .then(function(res) {
          chart.data(res).render();
        })
        .catch(function(err) {
          chart.message(err.message);
        });

    });
    Keen.ready(function() {
      var el = document.getElementById("travisci-projects-count_unique");
      var chart = new Keen.Dataviz()
        .el(el)
        .chartType('metric')
        .title('Active Travis CI Projects (14d)')
        .prepare();

      client
        .query("count_unique", {
          event_collection: "travisci",
          target_property: "repository.name",
          timeframe: "this_14_years",
          timezone: "UTC"
        })
        .then(function(res) {
          chart.data(res).render();
        })
        .catch(function(err) {
          chart.message(err.message);
        });

    });
    Keen.ready(function() {
      var el = document.getElementById("travisci-projects-sum-duration");
      var chart = new Keen.Dataviz()
        .el(el)
        .chartType('metric')
        .title('Verbrauchte Build Zeit (14d)')
        .prepare();


      client
        .query("sum", {
          event_collection: "travisci",
          target_property: "duration",
          timeframe: "this_14_years",
          timezone: "UTC"
        })
        .then(function(res) {

          chart.data(res);
          //chart.parseRawData({ result: res });
          chart.call(function(){
            // Modify internal Dataset instance
            this.dataset.updateColumn(1, function(value, index, column){
              // Divide each value in column 1 by 100
              console.log("foo"+value);

              return value / 60 / 60;
            });
          })
          .render();
        })
        .catch(function(err) {
          chart.message(err.message);
        });



    });
    Keen.ready(function() {
      var el = document.getElementById("travisci-projects-duration");
      var chart = new Keen.Dataviz()
        .el(el)
        .chartType('linechart')
        .title('Project Build Zeit in Sec (14d)')
        .prepare();

      client
        .query("average", {
            event_collection: "travisci",
            group_by: ["repository.name"],
            interval: "daily",
            target_property: "duration",
            timeframe: "this_14_days",
            timezone: "Europe/Paris"
        })
        .then(function(res) {
          chart.data(res).render();
        })
        .catch(function(err) {
          chart.message(err.message);
        });

    });



  });
</script>
